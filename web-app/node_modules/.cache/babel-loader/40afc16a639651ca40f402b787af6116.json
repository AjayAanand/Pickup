{"ast":null,"code":"import{FETCH_BOOKING_LOCATION,FETCH_BOOKING_LOCATION_SUCCESS,FETCH_BOOKING_LOCATION_FAILED,STOP_LOCATION_FETCH}from\"../store/types\";import store from'../store/store';import{firebase}from'../config/configureFirebase';import{query,onValue,set,off,push,limitToLast}from\"firebase/database\";export var saveTracking=function saveTracking(bookingId,location){var trackingRef=firebase.trackingRef;push(trackingRef(bookingId),location);};export var fetchBookingLocations=function fetchBookingLocations(bookingId){return function(dispatch){var trackingRef=firebase.trackingRef;dispatch({type:FETCH_BOOKING_LOCATION,payload:bookingId});onValue(query(trackingRef(bookingId),limitToLast(1)),function(snapshot){if(snapshot.val()){var data=snapshot.val();var locations=Object.keys(data).map(function(i){return data[i];});if(locations.length==1){dispatch({type:FETCH_BOOKING_LOCATION_SUCCESS,payload:locations[0]});}else{dispatch({type:FETCH_BOOKING_LOCATION_FAILED,payload:store.getState().languagedata.defaultLanguage.location_fetch_error});}}else{dispatch({type:FETCH_BOOKING_LOCATION_FAILED,payload:store.getState().languagedata.defaultLanguage.location_fetch_error});}});};};export var stopLocationFetch=function stopLocationFetch(bookingId){return function(dispatch){var trackingRef=firebase.trackingRef;dispatch({type:STOP_LOCATION_FETCH,payload:bookingId});off(trackingRef(bookingId));};};export var saveUserLocation=function saveUserLocation(location){var auth=firebase.auth,userLocationRef=firebase.userLocationRef;var uid=auth.currentUser.uid;set(userLocationRef(uid),location);};","map":{"version":3,"names":["FETCH_BOOKING_LOCATION","FETCH_BOOKING_LOCATION_SUCCESS","FETCH_BOOKING_LOCATION_FAILED","STOP_LOCATION_FETCH","store","firebase","query","onValue","set","off","push","limitToLast","saveTracking","bookingId","location","trackingRef","fetchBookingLocations","dispatch","type","payload","snapshot","val","data","locations","Object","keys","map","i","length","getState","languagedata","defaultLanguage","location_fetch_error","stopLocationFetch","saveUserLocation","auth","userLocationRef","uid","currentUser"],"sources":["/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/common/src/actions/locationactions.js"],"sourcesContent":["import {\r\n    FETCH_BOOKING_LOCATION,\r\n    FETCH_BOOKING_LOCATION_SUCCESS,\r\n    FETCH_BOOKING_LOCATION_FAILED,\r\n    STOP_LOCATION_FETCH\r\n} from \"../store/types\";\r\nimport store from '../store/store';\r\nimport { firebase } from '../config/configureFirebase';\r\nimport { query, onValue, set, off, push, limitToLast } from \"firebase/database\";\r\n\r\nexport const saveTracking = (bookingId, location) => {\r\n    const {\r\n        trackingRef\r\n    } = firebase;\r\n    push(trackingRef(bookingId), location);\r\n}\r\n\r\nexport const fetchBookingLocations = (bookingId) => (dispatch) => {\r\n\r\n    const {\r\n        trackingRef\r\n    } = firebase;\r\n\r\n    dispatch({\r\n        type: FETCH_BOOKING_LOCATION,\r\n        payload: bookingId,\r\n    });\r\n    onValue(query(trackingRef(bookingId), limitToLast(1)),(snapshot) => {\r\n        if (snapshot.val()) {\r\n            let data = snapshot.val();\r\n            const locations = Object.keys(data)\r\n                .map((i) => {\r\n                    return data[i]\r\n                });\r\n            if (locations.length == 1) {\r\n                dispatch({\r\n                    type: FETCH_BOOKING_LOCATION_SUCCESS,\r\n                    payload: locations[0]\r\n                });\r\n            }\r\n            else {\r\n                dispatch({\r\n                    type: FETCH_BOOKING_LOCATION_FAILED,\r\n                    payload: store.getState().languagedata.defaultLanguage.location_fetch_error,\r\n                });\r\n            }\r\n        } else {\r\n            dispatch({\r\n                type: FETCH_BOOKING_LOCATION_FAILED,\r\n                payload: store.getState().languagedata.defaultLanguage.location_fetch_error,\r\n            });\r\n        }\r\n    });\r\n};\r\n\r\nexport const stopLocationFetch = (bookingId) => (dispatch) => {\r\n\r\n    const {\r\n        trackingRef\r\n    } = firebase;\r\n\r\n    dispatch({\r\n        type: STOP_LOCATION_FETCH,\r\n        payload: bookingId,\r\n    });\r\n    off(trackingRef(bookingId));\r\n}\r\n\r\nexport const saveUserLocation = (location) => {\r\n    const {\r\n      auth,\r\n      userLocationRef,\r\n    } = firebase;\r\n    const uid = auth.currentUser.uid;\r\n    set(userLocationRef(uid),location);\r\n}"],"mappings":"AAAA,OACIA,sBAAsB,CACtBC,8BAA8B,CAC9BC,6BAA6B,CAC7BC,mBAAmB,KAChB,gBAAgB,CACvB,MAAO,CAAAC,KAAK,KAAM,gBAAgB,CAClC,OAASC,QAAQ,KAAQ,6BAA6B,CACtD,OAASC,KAAK,CAAEC,OAAO,CAAEC,GAAG,CAAEC,GAAG,CAAEC,IAAI,CAAEC,WAAW,KAAQ,mBAAmB,CAE/E,MAAO,IAAM,CAAAC,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAIC,SAAS,CAAEC,QAAQ,CAAK,CACjD,GACI,CAAAC,WAAW,CACXV,QAAQ,CADRU,WAAW,CAEfL,IAAI,CAACK,WAAW,CAACF,SAAS,CAAC,CAAEC,QAAQ,CAAC,CAC1C,CAAC,CAED,MAAO,IAAM,CAAAE,qBAAqB,CAAG,QAAxB,CAAAA,qBAAqBA,CAAIH,SAAS,QAAK,UAACI,QAAQ,CAAK,CAE9D,GACI,CAAAF,WAAW,CACXV,QAAQ,CADRU,WAAW,CAGfE,QAAQ,CAAC,CACLC,IAAI,CAAElB,sBAAsB,CAC5BmB,OAAO,CAAEN,SACb,CAAC,CAAC,CACFN,OAAO,CAACD,KAAK,CAACS,WAAW,CAACF,SAAS,CAAC,CAAEF,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,SAACS,QAAQ,CAAK,CAChE,GAAIA,QAAQ,CAACC,GAAG,EAAE,CAAE,CAChB,GAAI,CAAAC,IAAI,CAAGF,QAAQ,CAACC,GAAG,EAAE,CACzB,GAAM,CAAAE,SAAS,CAAGC,MAAM,CAACC,IAAI,CAACH,IAAI,CAAC,CAC9BI,GAAG,CAAC,SAACC,CAAC,CAAK,CACR,MAAO,CAAAL,IAAI,CAACK,CAAC,CAAC,CAClB,CAAC,CAAC,CACN,GAAIJ,SAAS,CAACK,MAAM,EAAI,CAAC,CAAE,CACvBX,QAAQ,CAAC,CACLC,IAAI,CAAEjB,8BAA8B,CACpCkB,OAAO,CAAEI,SAAS,CAAC,CAAC,CACxB,CAAC,CAAC,CACN,CAAC,IACI,CACDN,QAAQ,CAAC,CACLC,IAAI,CAAEhB,6BAA6B,CACnCiB,OAAO,CAAEf,KAAK,CAACyB,QAAQ,EAAE,CAACC,YAAY,CAACC,eAAe,CAACC,oBAC3D,CAAC,CAAC,CACN,CACJ,CAAC,IAAM,CACHf,QAAQ,CAAC,CACLC,IAAI,CAAEhB,6BAA6B,CACnCiB,OAAO,CAAEf,KAAK,CAACyB,QAAQ,EAAE,CAACC,YAAY,CAACC,eAAe,CAACC,oBAC3D,CAAC,CAAC,CACN,CACJ,CAAC,CAAC,CACN,CAAC,GAED,MAAO,IAAM,CAAAC,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAIpB,SAAS,QAAK,UAACI,QAAQ,CAAK,CAE1D,GACI,CAAAF,WAAW,CACXV,QAAQ,CADRU,WAAW,CAGfE,QAAQ,CAAC,CACLC,IAAI,CAAEf,mBAAmB,CACzBgB,OAAO,CAAEN,SACb,CAAC,CAAC,CACFJ,GAAG,CAACM,WAAW,CAACF,SAAS,CAAC,CAAC,CAC/B,CAAC,GAED,MAAO,IAAM,CAAAqB,gBAAgB,CAAG,QAAnB,CAAAA,gBAAgBA,CAAIpB,QAAQ,CAAK,CAC1C,GACE,CAAAqB,IAAI,CAEF9B,QAAQ,CAFV8B,IAAI,CACJC,eAAe,CACb/B,QAAQ,CADV+B,eAAe,CAEjB,GAAM,CAAAC,GAAG,CAAGF,IAAI,CAACG,WAAW,CAACD,GAAG,CAChC7B,GAAG,CAAC4B,eAAe,CAACC,GAAG,CAAC,CAACvB,QAAQ,CAAC,CACtC,CAAC"},"metadata":{},"sourceType":"module"}