{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{FETCH_DRIVERS_EARNING,FETCH_DRIVERS__EARNING_SUCCESS,FETCH_DRIVERS__EARNING_FAILED}from\"../store/types\";import store from'../store/store';import{firebase}from'../config/configureFirebase';import{get,onValue}from\"firebase/database\";export var fetchDriverEarnings=function fetchDriverEarnings(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var bookingListRef,settingsRef,userInfo,settingsdata,settings;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:bookingListRef=firebase.bookingListRef,settingsRef=firebase.settingsRef;dispatch({type:FETCH_DRIVERS_EARNING,payload:null});userInfo=store.getState().auth.profile;_context.next=5;return get(settingsRef);case 5:settingsdata=_context.sent;settings=settingsdata.val();onValue(bookingListRef(userInfo.uid,userInfo.usertype),function(snapshot){if(snapshot.val()){var mainArr=snapshot.val();var monthsName=['January','February','March','April','May','June','July','August','September','October','November','December'];var renderobj={};Object.keys(mainArr).map(function(j){if((mainArr[j].status==='PAID'||mainArr[j].status==='COMPLETE')&&mainArr[j].driver_share!==undefined){var bdt=new Date(mainArr[j].tripdate);var uniqueKey=bdt.getFullYear()+'_'+bdt.getMonth()+'_'+mainArr[j].driver;if(renderobj[uniqueKey]&&renderobj[uniqueKey].driverShare>0){renderobj[uniqueKey].driverShare=(parseFloat(renderobj[uniqueKey].driverShare)+parseFloat(mainArr[j].driver_share)).toFixed(settings.decimal);renderobj[uniqueKey]['total_rides']=renderobj[uniqueKey]['total_rides']+1;}else{renderobj[uniqueKey]={};renderobj[uniqueKey]['dated']=mainArr[j].tripdate;renderobj[uniqueKey]['year']=bdt.getFullYear();renderobj[uniqueKey]['month']=bdt.getMonth();renderobj[uniqueKey]['monthsName']=monthsName[bdt.getMonth()];renderobj[uniqueKey]['driverName']=mainArr[j].driver_name;renderobj[uniqueKey]['driverShare']=parseFloat(mainArr[j].driver_share).toFixed(settings.decimal);renderobj[uniqueKey]['driverVehicleNo']=mainArr[j].vehicle_number;renderobj[uniqueKey]['driverUId']=mainArr[j].driver;renderobj[uniqueKey]['uniqueKey']=uniqueKey;renderobj[uniqueKey]['total_rides']=1;}}return null;});if(renderobj){var arr=Object.keys(renderobj).map(function(i){renderobj[i].driverShare=parseFloat(renderobj[i].driverShare).toFixed(settings.decimal);return renderobj[i];});dispatch({type:FETCH_DRIVERS__EARNING_SUCCESS,payload:arr});}}else{dispatch({type:FETCH_DRIVERS__EARNING_FAILED,payload:\"No data available.\"});}});case 8:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};","map":{"version":3,"names":["FETCH_DRIVERS_EARNING","FETCH_DRIVERS__EARNING_SUCCESS","FETCH_DRIVERS__EARNING_FAILED","store","firebase","get","onValue","fetchDriverEarnings","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","dispatch","bookingListRef","settingsRef","userInfo","settingsdata","settings","wrap","_callee$","_context","prev","next","type","payload","getState","auth","profile","sent","val","uid","usertype","snapshot","mainArr","monthsName","renderobj","Object","keys","map","j","status","driver_share","undefined","bdt","Date","tripdate","uniqueKey","getFullYear","getMonth","driver","driverShare","parseFloat","toFixed","decimal","driver_name","vehicle_number","arr","i","stop","_x","apply","arguments"],"sources":["/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/common/src/actions/driverearningaction.js"],"sourcesContent":["import {\r\n  FETCH_DRIVERS_EARNING,\r\n  FETCH_DRIVERS__EARNING_SUCCESS,\r\n  FETCH_DRIVERS__EARNING_FAILED,\r\n} from \"../store/types\";\r\nimport store from '../store/store';\r\nimport { firebase } from '../config/configureFirebase';\r\nimport { get, onValue } from \"firebase/database\";\r\n\r\nexport const fetchDriverEarnings = () => async (dispatch) => {\r\n\r\n  const {\r\n    bookingListRef,\r\n    settingsRef\r\n  } = firebase;\r\n\r\n  dispatch({\r\n    type: FETCH_DRIVERS_EARNING,\r\n    payload: null\r\n  });\r\n\r\n  const userInfo = store.getState().auth.profile;\r\n  const settingsdata = await get(settingsRef);\r\n  const settings = settingsdata.val();\r\n\r\n  onValue(bookingListRef(userInfo.uid, userInfo.usertype), snapshot => {\r\n    if (snapshot.val()) {\r\n      const mainArr = snapshot.val();\r\n      var monthsName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\n      var renderobj = {};\r\n      Object.keys(mainArr).map(j => {\r\n\r\n        if ((mainArr[j].status === 'PAID' || mainArr[j].status === 'COMPLETE') && mainArr[j].driver_share !== undefined) {\r\n          let bdt = new Date(mainArr[j].tripdate);\r\n          let uniqueKey = bdt.getFullYear() + '_' + bdt.getMonth() + '_' + mainArr[j].driver;\r\n          if (renderobj[uniqueKey] && renderobj[uniqueKey].driverShare > 0) {\r\n            renderobj[uniqueKey].driverShare = (parseFloat(renderobj[uniqueKey].driverShare) + parseFloat(mainArr[j].driver_share)).toFixed(settings.decimal);\r\n            renderobj[uniqueKey]['total_rides'] = renderobj[uniqueKey]['total_rides'] + 1;\r\n          } else {\r\n            renderobj[uniqueKey] = {};\r\n            renderobj[uniqueKey]['dated'] = mainArr[j].tripdate;\r\n            renderobj[uniqueKey]['year'] = bdt.getFullYear();\r\n            renderobj[uniqueKey]['month'] = bdt.getMonth();\r\n            renderobj[uniqueKey]['monthsName'] = monthsName[bdt.getMonth()];\r\n            renderobj[uniqueKey]['driverName'] = mainArr[j].driver_name;\r\n            renderobj[uniqueKey]['driverShare'] = parseFloat(mainArr[j].driver_share).toFixed(settings.decimal);\r\n            renderobj[uniqueKey]['driverVehicleNo'] = mainArr[j].vehicle_number;\r\n            renderobj[uniqueKey]['driverUId'] = mainArr[j].driver;\r\n            renderobj[uniqueKey]['uniqueKey'] = uniqueKey;\r\n            renderobj[uniqueKey]['total_rides'] = 1;\r\n          }\r\n        }\r\n        return null;\r\n      });\r\n      if (renderobj) {\r\n        const arr = Object.keys(renderobj).map(i => {\r\n          renderobj[i].driverShare = parseFloat(renderobj[i].driverShare).toFixed(settings.decimal)\r\n          return renderobj[i]\r\n        })\r\n        dispatch({\r\n          type: FETCH_DRIVERS__EARNING_SUCCESS,\r\n          payload: arr\r\n        });\r\n      }\r\n\r\n    } else {\r\n      dispatch({\r\n        type: FETCH_DRIVERS__EARNING_FAILED,\r\n        payload: \"No data available.\"\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}