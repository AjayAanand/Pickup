{"ast":null,"code":"import{FETCH_MESSAGES,FETCH_MESSAGES_SUCCESS,FETCH_MESSAGES_FAILED,SEND_MESSAGE,STOP_FETCH_MESSAGES}from\"../store/types\";import store from'../store/store';import{firebase}from'../config/configureFirebase';import{RequestPushMsg}from'../other/NotificationFunctions';import{onValue,push,off,child}from\"firebase/database\";export var fetchChatMessages=function fetchChatMessages(bookingId){return function(dispatch){var chatRef=firebase.chatRef;dispatch({type:FETCH_MESSAGES,payload:bookingId});onValue(chatRef(bookingId),function(snapshot){if(snapshot.val()){var rootEntry=snapshot.val();var allMesseges=[];for(var key in rootEntry){var entryKey=rootEntry[key];for(var msgKey in entryKey){entryKey[msgKey].smsId=msgKey;allMesseges.push(entryKey[msgKey]);}}dispatch({type:FETCH_MESSAGES_SUCCESS,payload:allMesseges});}else{dispatch({type:FETCH_MESSAGES_FAILED,payload:store.getState().languagedata.defaultLanguage.chat_not_found});}});};};export var sendMessage=function sendMessage(data){return function(dispatch){var chatRef=firebase.chatRef;var chatId=data.booking.customer+','+data.booking.driver;var today=new Date();var time=today.getHours()+\":\"+today.getMinutes();var dd=String(today.getDate()).padStart(2,'0');var mm=String(today.getMonth()+1).padStart(2,'0');var yyyy=today.getFullYear();today=mm+':'+dd+':'+yyyy;var msg={message:data.message,from:data.role=='customer'?data.booking.customer:data.booking.driver,type:\"msg\",msgDate:today,msgTime:time,createdAt:new Date().toString(),source:data.role};push(child(chatRef(data.booking.id),chatId),msg);if(data.role=='customer'){if(data.booking.driver_token){RequestPushMsg(data.booking.driver_token,{title:store.getState().languagedata.defaultLanguage.notification_title+store.getState().languagedata.defaultLanguage.chat_requested,msg:data.message,screen:'onlineChat',params:{bookingId:data.booking.id}});}}else{if(data.booking.customer_token){RequestPushMsg(data.booking.customer_token,{title:store.getState().languagedata.defaultLanguage.notification_title+store.getState().languagedata.defaultLanguage.chat_requested,msg:data.message,screen:'onlineChat',params:{bookingId:data.booking.id}});}}dispatch({type:SEND_MESSAGE,payload:msg});};};export var stopFetchMessages=function stopFetchMessages(bookingId){return function(dispatch){var chatRef=firebase.chatRef;dispatch({type:STOP_FETCH_MESSAGES,payload:bookingId});off(chatRef(bookingId));};};","map":{"version":3,"names":["FETCH_MESSAGES","FETCH_MESSAGES_SUCCESS","FETCH_MESSAGES_FAILED","SEND_MESSAGE","STOP_FETCH_MESSAGES","store","firebase","RequestPushMsg","onValue","push","off","child","fetchChatMessages","bookingId","dispatch","chatRef","type","payload","snapshot","val","rootEntry","allMesseges","key","entryKey","msgKey","smsId","getState","languagedata","defaultLanguage","chat_not_found","sendMessage","data","chatId","booking","customer","driver","today","Date","time","getHours","getMinutes","dd","String","getDate","padStart","mm","getMonth","yyyy","getFullYear","msg","message","from","role","msgDate","msgTime","createdAt","toString","source","id","driver_token","title","notification_title","chat_requested","screen","params","customer_token","stopFetchMessages"],"sources":["/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/common/src/actions/chatactions.js"],"sourcesContent":["import {\r\n    FETCH_MESSAGES,\r\n    FETCH_MESSAGES_SUCCESS,\r\n    FETCH_MESSAGES_FAILED,\r\n    SEND_MESSAGE,\r\n    STOP_FETCH_MESSAGES\r\n} from \"../store/types\";\r\nimport store from '../store/store';\r\nimport { firebase } from '../config/configureFirebase';\r\nimport { RequestPushMsg } from '../other/NotificationFunctions';\r\nimport { onValue, push, off, child } from \"firebase/database\";\r\n\r\nexport const fetchChatMessages = (bookingId) => (dispatch) => {\r\n\r\n    const {\r\n        chatRef\r\n    } = firebase;\r\n  \r\n    dispatch({\r\n        type: FETCH_MESSAGES,\r\n        payload: bookingId,\r\n    });\r\n    onValue(chatRef(bookingId), snapshot => {\r\n        if(snapshot.val()){\r\n            let rootEntry = snapshot.val();\r\n            let allMesseges = [];\r\n            for (let key in rootEntry) {\r\n                let entryKey = rootEntry[key]\r\n                for (let msgKey in entryKey) {\r\n                  entryKey[msgKey].smsId = msgKey\r\n                  allMesseges.push(entryKey[msgKey])\r\n                }\r\n            }\r\n            dispatch({\r\n                type: FETCH_MESSAGES_SUCCESS,\r\n                payload: allMesseges,\r\n            });\r\n        }else{\r\n            dispatch({\r\n                type: FETCH_MESSAGES_FAILED,\r\n                payload: store.getState().languagedata.defaultLanguage.chat_not_found,\r\n            });\r\n        }\r\n    })\r\n};\r\n\r\nexport const sendMessage = (data) => (dispatch) => {\r\n\r\n    const {\r\n        chatRef\r\n    } = firebase;\r\n\r\n    const chatId = data.booking.customer + ','  + data.booking.driver\r\n    var today = new Date();\r\n    var time = today.getHours() + \":\" + today.getMinutes();\r\n    var dd = String(today.getDate()).padStart(2, '0');\r\n    var mm = String(today.getMonth() + 1).padStart(2, '0'); \r\n    var yyyy = today.getFullYear();\r\n    today = mm + ':' + dd + ':' + yyyy;\r\n    \r\n    const msg = {\r\n        message:data.message,\r\n        from: data.role == 'customer'? data.booking.customer : data.booking.driver,\r\n        type:\"msg\",\r\n        msgDate:today,\r\n        msgTime:time,\r\n        createdAt: new Date().toString(),\r\n        source: data.role\r\n    };\r\n\r\n    push(child(chatRef(data.booking.id), chatId), msg);\r\n\r\n    if(data.role == 'customer'){\r\n        if(data.booking.driver_token){\r\n            RequestPushMsg(\r\n                data.booking.driver_token,\r\n                {\r\n                    title: store.getState().languagedata.defaultLanguage.notification_title  + store.getState().languagedata.defaultLanguage.chat_requested,\r\n                    msg: data.message,\r\n                    screen: 'onlineChat',\r\n                    params: { bookingId: data.booking.id }\r\n                });\r\n        }\r\n    }else{\r\n        if(data.booking.customer_token){\r\n            RequestPushMsg(\r\n                data.booking.customer_token,\r\n                {\r\n                    title: store.getState().languagedata.defaultLanguage.notification_title  + store.getState().languagedata.defaultLanguage.chat_requested,\r\n                    msg: data.message,\r\n                    screen: 'onlineChat',\r\n                    params: { bookingId: data.booking.id}\r\n                });\r\n        }\r\n    }\r\n\r\n    dispatch({\r\n        type: SEND_MESSAGE,\r\n        payload: msg,\r\n    });\r\n}\r\n\r\nexport const stopFetchMessages = (bookingId) => (dispatch) => {\r\n\r\n    const {\r\n        chatRef \r\n    } = firebase;\r\n\r\n    dispatch({\r\n        type: STOP_FETCH_MESSAGES,\r\n        payload: bookingId,\r\n    });\r\n    off(chatRef(bookingId));\r\n}"],"mappings":"AAAA,OACIA,cAAc,CACdC,sBAAsB,CACtBC,qBAAqB,CACrBC,YAAY,CACZC,mBAAmB,KAChB,gBAAgB,CACvB,MAAO,CAAAC,KAAK,KAAM,gBAAgB,CAClC,OAASC,QAAQ,KAAQ,6BAA6B,CACtD,OAASC,cAAc,KAAQ,gCAAgC,CAC/D,OAASC,OAAO,CAAEC,IAAI,CAAEC,GAAG,CAAEC,KAAK,KAAQ,mBAAmB,CAE7D,MAAO,IAAM,CAAAC,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAIC,SAAS,QAAK,UAACC,QAAQ,CAAK,CAE1D,GACI,CAAAC,OAAO,CACPT,QAAQ,CADRS,OAAO,CAGXD,QAAQ,CAAC,CACLE,IAAI,CAAEhB,cAAc,CACpBiB,OAAO,CAAEJ,SACb,CAAC,CAAC,CACFL,OAAO,CAACO,OAAO,CAACF,SAAS,CAAC,CAAE,SAAAK,QAAQ,CAAI,CACpC,GAAGA,QAAQ,CAACC,GAAG,EAAE,CAAC,CACd,GAAI,CAAAC,SAAS,CAAGF,QAAQ,CAACC,GAAG,EAAE,CAC9B,GAAI,CAAAE,WAAW,CAAG,EAAE,CACpB,IAAK,GAAI,CAAAC,GAAG,GAAI,CAAAF,SAAS,CAAE,CACvB,GAAI,CAAAG,QAAQ,CAAGH,SAAS,CAACE,GAAG,CAAC,CAC7B,IAAK,GAAI,CAAAE,MAAM,GAAI,CAAAD,QAAQ,CAAE,CAC3BA,QAAQ,CAACC,MAAM,CAAC,CAACC,KAAK,CAAGD,MAAM,CAC/BH,WAAW,CAACZ,IAAI,CAACc,QAAQ,CAACC,MAAM,CAAC,CAAC,CACpC,CACJ,CACAV,QAAQ,CAAC,CACLE,IAAI,CAAEf,sBAAsB,CAC5BgB,OAAO,CAAEI,WACb,CAAC,CAAC,CACN,CAAC,IAAI,CACDP,QAAQ,CAAC,CACLE,IAAI,CAAEd,qBAAqB,CAC3Be,OAAO,CAAEZ,KAAK,CAACqB,QAAQ,EAAE,CAACC,YAAY,CAACC,eAAe,CAACC,cAC3D,CAAC,CAAC,CACN,CACJ,CAAC,CAAC,CACN,CAAC,GAED,MAAO,IAAM,CAAAC,WAAW,CAAG,QAAd,CAAAA,WAAWA,CAAIC,IAAI,QAAK,UAACjB,QAAQ,CAAK,CAE/C,GACI,CAAAC,OAAO,CACPT,QAAQ,CADRS,OAAO,CAGX,GAAM,CAAAiB,MAAM,CAAGD,IAAI,CAACE,OAAO,CAACC,QAAQ,CAAG,GAAG,CAAIH,IAAI,CAACE,OAAO,CAACE,MAAM,CACjE,GAAI,CAAAC,KAAK,CAAG,GAAI,CAAAC,IAAI,EAAE,CACtB,GAAI,CAAAC,IAAI,CAAGF,KAAK,CAACG,QAAQ,EAAE,CAAG,GAAG,CAAGH,KAAK,CAACI,UAAU,EAAE,CACtD,GAAI,CAAAC,EAAE,CAAGC,MAAM,CAACN,KAAK,CAACO,OAAO,EAAE,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CACjD,GAAI,CAAAC,EAAE,CAAGH,MAAM,CAACN,KAAK,CAACU,QAAQ,EAAE,CAAG,CAAC,CAAC,CAACF,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CACtD,GAAI,CAAAG,IAAI,CAAGX,KAAK,CAACY,WAAW,EAAE,CAC9BZ,KAAK,CAAGS,EAAE,CAAG,GAAG,CAAGJ,EAAE,CAAG,GAAG,CAAGM,IAAI,CAElC,GAAM,CAAAE,GAAG,CAAG,CACRC,OAAO,CAACnB,IAAI,CAACmB,OAAO,CACpBC,IAAI,CAAEpB,IAAI,CAACqB,IAAI,EAAI,UAAU,CAAErB,IAAI,CAACE,OAAO,CAACC,QAAQ,CAAGH,IAAI,CAACE,OAAO,CAACE,MAAM,CAC1EnB,IAAI,CAAC,KAAK,CACVqC,OAAO,CAACjB,KAAK,CACbkB,OAAO,CAAChB,IAAI,CACZiB,SAAS,CAAE,GAAI,CAAAlB,IAAI,EAAE,CAACmB,QAAQ,EAAE,CAChCC,MAAM,CAAE1B,IAAI,CAACqB,IACjB,CAAC,CAED3C,IAAI,CAACE,KAAK,CAACI,OAAO,CAACgB,IAAI,CAACE,OAAO,CAACyB,EAAE,CAAC,CAAE1B,MAAM,CAAC,CAAEiB,GAAG,CAAC,CAElD,GAAGlB,IAAI,CAACqB,IAAI,EAAI,UAAU,CAAC,CACvB,GAAGrB,IAAI,CAACE,OAAO,CAAC0B,YAAY,CAAC,CACzBpD,cAAc,CACVwB,IAAI,CAACE,OAAO,CAAC0B,YAAY,CACzB,CACIC,KAAK,CAAEvD,KAAK,CAACqB,QAAQ,EAAE,CAACC,YAAY,CAACC,eAAe,CAACiC,kBAAkB,CAAIxD,KAAK,CAACqB,QAAQ,EAAE,CAACC,YAAY,CAACC,eAAe,CAACkC,cAAc,CACvIb,GAAG,CAAElB,IAAI,CAACmB,OAAO,CACjBa,MAAM,CAAE,YAAY,CACpBC,MAAM,CAAE,CAAEnD,SAAS,CAAEkB,IAAI,CAACE,OAAO,CAACyB,EAAG,CACzC,CAAC,CAAC,CACV,CACJ,CAAC,IAAI,CACD,GAAG3B,IAAI,CAACE,OAAO,CAACgC,cAAc,CAAC,CAC3B1D,cAAc,CACVwB,IAAI,CAACE,OAAO,CAACgC,cAAc,CAC3B,CACIL,KAAK,CAAEvD,KAAK,CAACqB,QAAQ,EAAE,CAACC,YAAY,CAACC,eAAe,CAACiC,kBAAkB,CAAIxD,KAAK,CAACqB,QAAQ,EAAE,CAACC,YAAY,CAACC,eAAe,CAACkC,cAAc,CACvIb,GAAG,CAAElB,IAAI,CAACmB,OAAO,CACjBa,MAAM,CAAE,YAAY,CACpBC,MAAM,CAAE,CAAEnD,SAAS,CAAEkB,IAAI,CAACE,OAAO,CAACyB,EAAE,CACxC,CAAC,CAAC,CACV,CACJ,CAEA5C,QAAQ,CAAC,CACLE,IAAI,CAAEb,YAAY,CAClBc,OAAO,CAAEgC,GACb,CAAC,CAAC,CACN,CAAC,GAED,MAAO,IAAM,CAAAiB,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAIrD,SAAS,QAAK,UAACC,QAAQ,CAAK,CAE1D,GACI,CAAAC,OAAO,CACPT,QAAQ,CADRS,OAAO,CAGXD,QAAQ,CAAC,CACLE,IAAI,CAAEZ,mBAAmB,CACzBa,OAAO,CAAEJ,SACb,CAAC,CAAC,CACFH,GAAG,CAACK,OAAO,CAACF,SAAS,CAAC,CAAC,CAC3B,CAAC"},"metadata":{},"sourceType":"module"}