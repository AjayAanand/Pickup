{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{CONFIRM_BOOKING,CONFIRM_BOOKING_SUCCESS,CONFIRM_BOOKING_FAILED,CLEAR_BOOKING}from\"../store/types\";import{RequestPushMsg}from'../other/NotificationFunctions';import store from'../store/store';import{firebase}from'../config/configureFirebase';import{formatBookingObject}from'../other/sharedFunctions';import{get,onValue,push}from\"firebase/database\";export var clearBooking=function clearBooking(){return function(dispatch){dispatch({type:CLEAR_BOOKING,payload:null});};};export var addBooking=function addBooking(bookingData){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var bookingRef,settingsRef,singleUserRef,settingsdata,settings,data,drivers;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:bookingRef=firebase.bookingRef,settingsRef=firebase.settingsRef,singleUserRef=firebase.singleUserRef;dispatch({type:CONFIRM_BOOKING,payload:bookingData});_context.next=4;return get(settingsRef);case 4:settingsdata=_context.sent;settings=settingsdata.val();_context.next=8;return formatBookingObject(bookingData,settings);case 8:data=_context.sent;if(bookingData.requestedDrivers){drivers=bookingData.requestedDrivers;Object.keys(drivers).map(function(uid){onValue(singleUserRef(uid),function(snapshot){if(snapshot.val()){var pushToken=snapshot.val().pushToken;var ios=snapshot.val().userPlatform==\"IOS\"?true:false;if(pushToken){RequestPushMsg(pushToken,{title:store.getState().languagedata.defaultLanguage.notification_title,msg:store.getState().languagedata.defaultLanguage.new_booking_notification,screen:'DriverTrips',channelId:settings.CarHornRepeat?'bookings-repeat':'bookings',ios:ios});}}},{onlyOnce:true});return drivers[uid];});}push(bookingRef,data).then(function(res){var bookingKey=res.key;dispatch({type:CONFIRM_BOOKING_SUCCESS,payload:{booking_id:bookingKey,mainData:_objectSpread(_objectSpread({},data),{},{id:bookingKey})}});}).catch(function(error){dispatch({type:CONFIRM_BOOKING_FAILED,payload:error.code+\": \"+error.message});});case 11:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};","map":{"version":3,"names":["CONFIRM_BOOKING","CONFIRM_BOOKING_SUCCESS","CONFIRM_BOOKING_FAILED","CLEAR_BOOKING","RequestPushMsg","store","firebase","formatBookingObject","get","onValue","push","clearBooking","dispatch","type","payload","addBooking","bookingData","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","bookingRef","settingsRef","singleUserRef","settingsdata","settings","data","drivers","wrap","_callee$","_context","prev","next","sent","val","requestedDrivers","Object","keys","map","uid","snapshot","pushToken","ios","userPlatform","title","getState","languagedata","defaultLanguage","notification_title","msg","new_booking_notification","screen","channelId","CarHornRepeat","onlyOnce","then","res","bookingKey","key","booking_id","mainData","_objectSpread","id","catch","error","code","message","stop","_x","apply","arguments"],"sources":["/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/common/src/actions/bookingactions.js"],"sourcesContent":["import {\r\n    CONFIRM_BOOKING,\r\n    CONFIRM_BOOKING_SUCCESS,\r\n    CONFIRM_BOOKING_FAILED,\r\n    CLEAR_BOOKING\r\n} from \"../store/types\";\r\nimport { RequestPushMsg } from '../other/NotificationFunctions';\r\nimport store from '../store/store';\r\nimport { firebase } from '../config/configureFirebase';\r\nimport { formatBookingObject } from '../other/sharedFunctions';\r\nimport { get, onValue, push } from \"firebase/database\";\r\n\r\nexport const clearBooking = () => (dispatch) => {\r\n    dispatch({\r\n        type: CLEAR_BOOKING,\r\n        payload: null,\r\n    });\r\n}\r\n\r\nexport const addBooking = (bookingData) => async (dispatch) => {\r\n\r\n    const   {\r\n        bookingRef,\r\n        settingsRef,\r\n        singleUserRef\r\n    } = firebase;\r\n\r\n    dispatch({\r\n        type: CONFIRM_BOOKING,\r\n        payload: bookingData,\r\n    });\r\n\r\n    const settingsdata = await get(settingsRef);\r\n    const settings = settingsdata.val();\r\n\r\n    let data = await formatBookingObject(bookingData, settings);\r\n\r\n    if(bookingData.requestedDrivers){\r\n        const drivers = bookingData.requestedDrivers;\r\n        Object.keys(drivers).map((uid)=>{\r\n            onValue(singleUserRef(uid),  snapshot => {\r\n                if (snapshot.val()) {\r\n                    const pushToken = snapshot.val().pushToken;\r\n                    const ios = snapshot.val().userPlatform == \"IOS\"? true: false\r\n                    if(pushToken){\r\n                        RequestPushMsg(\r\n                            pushToken,\r\n                            {\r\n                                title: store.getState().languagedata.defaultLanguage.notification_title,\r\n                                msg: store.getState().languagedata.defaultLanguage.new_booking_notification,\r\n                                screen: 'DriverTrips',\r\n                                channelId: settings.CarHornRepeat? 'bookings-repeat': 'bookings',\r\n                                ios: ios\r\n                            });\r\n                     }\r\n                 }\r\n            }, {onlyOnce: true});\r\n            return drivers[uid];\r\n        })\r\n    }\r\n\r\n    push(bookingRef, data).then((res) => {\r\n        var bookingKey = res.key;\r\n        dispatch({\r\n            type: CONFIRM_BOOKING_SUCCESS,\r\n            payload: {\r\n                booking_id:bookingKey,\r\n                mainData:{\r\n                    ...data,\r\n                    id:bookingKey\r\n                }\r\n            }    \r\n        });\r\n    }).catch(error => {\r\n        dispatch({\r\n            type: CONFIRM_BOOKING_FAILED,\r\n            payload: error.code + \": \" + error.message,\r\n        });\r\n    });\r\n};\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}