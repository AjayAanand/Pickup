{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{FETCH_CARS,FETCH_CARS_SUCCESS,FETCH_CARS_FAILED,EDIT_CAR}from\"../store/types\";import store from'../store/store';import{firebase}from'../config/configureFirebase';import{onValue,update,set,child,remove,push}from\"firebase/database\";import{uploadBytesResumable,getDownloadURL}from\"firebase/storage\";export var fetchCars=function fetchCars(){return function(dispatch){var carsRef=firebase.carsRef;dispatch({type:FETCH_CARS,payload:null});var userInfo=store.getState().auth.profile;onValue(carsRef(userInfo.uid,userInfo.usertype),function(snapshot){if(snapshot.val()){var data=snapshot.val();var arr=Object.keys(data).map(function(i){data[i].id=i;return data[i];});dispatch({type:FETCH_CARS_SUCCESS,payload:arr});}else{dispatch({type:FETCH_CARS_FAILED,payload:store.getState().languagedata.defaultLanguage.no_cars});}});};};export var editCar=function editCar(car,method){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var singleUserRef,carAddRef,carEditRef,carImage,image,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:singleUserRef=firebase.singleUserRef,carAddRef=firebase.carAddRef,carEditRef=firebase.carEditRef,carImage=firebase.carImage;dispatch({type:EDIT_CAR,payload:{method:method,car:car}});if(!(method==='Add')){_context.next=6;break;}push(carAddRef,car);_context.next=23;break;case 6:if(!(method==='Delete')){_context.next=10;break;}remove(carEditRef(car.id));_context.next=23;break;case 10:if(!(method==='UpdateImage')){_context.next=22;break;}_context.next=13;return uploadBytesResumable(carImage(car.id),car.car_image);case 13:_context.next=15;return getDownloadURL(carImage(car.id));case 15:image=_context.sent;data=car;data.car_image=image;set(carEditRef(car.id),data);if(car.active&&car.driver){update(singleUserRef(car.driver),{updateAt:new Date().getTime(),car_image:image});}_context.next=23;break;case 22:set(carEditRef(car.id),car);case 23:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var updateUserCarWithImage=function updateUserCarWithImage(newData,blob){return function(dispatch){var auth=firebase.auth,carAddRef=firebase.carAddRef,singleUserRef=firebase.singleUserRef,carImage=firebase.carImage;var carId=push(carAddRef).key;uploadBytesResumable(carImage(carId),blob).then(function(){blob.close();return getDownloadURL(carImage(carId));}).then(function(url){newData.car_image=url;set(child(carAddRef,carId),newData);if(newData.active){var updateData={carType:newData.carType,vehicleNumber:newData.vehicleNumber,vehicleMake:newData.vehicleMake,vehicleModel:newData.vehicleModel,other_info:newData.other_info,car_image:url,carApproved:newData.approved,updateAt:new Date().getTime()};update(singleUserRef(auth.currentUser.uid),updateData);}});};};","map":{"version":3,"names":["FETCH_CARS","FETCH_CARS_SUCCESS","FETCH_CARS_FAILED","EDIT_CAR","store","firebase","onValue","update","set","child","remove","push","uploadBytesResumable","getDownloadURL","fetchCars","dispatch","carsRef","type","payload","userInfo","getState","auth","profile","uid","usertype","snapshot","val","data","arr","Object","keys","map","i","id","languagedata","defaultLanguage","no_cars","editCar","car","method","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","singleUserRef","carAddRef","carEditRef","carImage","image","wrap","_callee$","_context","prev","next","car_image","sent","active","driver","updateAt","Date","getTime","stop","_x","apply","arguments","updateUserCarWithImage","newData","blob","carId","key","then","close","url","updateData","carType","vehicleNumber","vehicleMake","vehicleModel","other_info","carApproved","approved","currentUser"],"sources":["/Users/sumitbajaj/Downloads/TAXI-PICK/Sourcecode/common/src/actions/caractions.js"],"sourcesContent":["import {\r\n    FETCH_CARS,\r\n    FETCH_CARS_SUCCESS,\r\n    FETCH_CARS_FAILED,\r\n    EDIT_CAR\r\n  } from \"../store/types\";\r\n  import store from '../store/store';\r\n  import { firebase } from '../config/configureFirebase';\r\n  import { onValue, update, set, child, remove, push } from \"firebase/database\";\r\n  import { uploadBytesResumable, getDownloadURL } from \"firebase/storage\";\r\n  \r\n  export const fetchCars = () => (dispatch) => {\r\n  \r\n    const {\r\n        carsRef\r\n    } = firebase;\r\n  \r\n    dispatch({\r\n      type: FETCH_CARS,\r\n      payload: null\r\n    });\r\n\r\n    const userInfo = store.getState().auth.profile;\r\n\r\n    onValue(carsRef(userInfo.uid, userInfo.usertype), snapshot => {\r\n      if (snapshot.val()) {\r\n        let data = snapshot.val();\r\n        const arr = Object.keys(data).map(i => {\r\n          data[i].id = i;\r\n          return data[i]\r\n        });\r\n        dispatch({\r\n          type: FETCH_CARS_SUCCESS,\r\n          payload: arr\r\n        });\r\n      } else {\r\n        dispatch({\r\n          type: FETCH_CARS_FAILED,\r\n          payload: store.getState().languagedata.defaultLanguage.no_cars\r\n        });\r\n      }\r\n    });\r\n  };\r\n  \r\n  export const editCar = (car, method) => async (dispatch) => {\r\n    const {\r\n      singleUserRef,\r\n      carAddRef, \r\n      carEditRef,\r\n      carImage\r\n    } = firebase;\r\n    dispatch({\r\n      type: EDIT_CAR,\r\n      payload: { method, car }\r\n    });\r\n    if (method === 'Add') {\r\n        push(carAddRef, car);\r\n    } else if (method === 'Delete') {\r\n        remove(carEditRef(car.id));\r\n    } else if (method === 'UpdateImage') {\r\n      await uploadBytesResumable(carImage(car.id),car.car_image);\r\n      let image = await getDownloadURL(carImage(car.id));\r\n      let data = car;\r\n      data.car_image = image;\r\n      set(carEditRef(car.id), data);\r\n      if(car.active && car.driver){\r\n        update(singleUserRef(car.driver), {\r\n          updateAt: new Date().getTime(),\r\n          car_image: image\r\n        });\r\n      }   \r\n    }\r\n     else {\r\n        set(carEditRef(car.id),car);\r\n    }\r\n  }\r\n\r\n  export const updateUserCarWithImage = (newData, blob) => (dispatch) => {\r\n    const {\r\n      auth,\r\n      carAddRef,\r\n      singleUserRef,\r\n      carImage\r\n    } = firebase;\r\n\r\n    var carId = push(carAddRef).key;\r\n\r\n    uploadBytesResumable(carImage(carId),blob).then(() => {\r\n      blob.close()\r\n      return getDownloadURL(carImage(carId))\r\n    }).then((url) => {\r\n      newData.car_image = url;\r\n      set(child(carAddRef, carId),newData )\r\n      if(newData.active){\r\n        let updateData = {\r\n          carType: newData.carType,\r\n          vehicleNumber: newData.vehicleNumber,\r\n          vehicleMake: newData.vehicleMake,\r\n          vehicleModel: newData.vehicleModel,\r\n          other_info: newData.other_info,\r\n          car_image:url,\r\n          carApproved: newData.approved,\r\n          updateAt: new Date().getTime()\r\n        };\r\n        update(singleUserRef(auth.currentUser.uid),updateData);\r\n      }\r\n    })\r\n  };"],"mappings":"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"},"metadata":{},"sourceType":"module"}